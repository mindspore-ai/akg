#define __aicore__ [aicore]
__aicore__ void moe_token_unpermute_op_impl_npu_0_kernel(__gm__ uint8_t *__restrict__ gm_permute_token, __gm__ uint8_t *__restrict__ gm_sorted_idx, __gm__ uint8_t *__restrict__ gm_probs, __gm__ uint8_t *__restrict__ gm_output) {
  __ubuf__ int32_t * ub_idx_1 = (__ubuf__ int32_t *)((uintptr_t)(0));
  __ubuf__ half * local_out_3 = (__ubuf__ half *)((uintptr_t)(28672));
  __ubuf__ int32_t * ub_142 = (__ubuf__ int32_t *)((uintptr_t)(100352));
  __ubuf__ half * prob_ub_7 = (__ubuf__ half *)((uintptr_t)(15360));
  __ubuf__ half * ub_5 = (__ubuf__ half *)((uintptr_t)(14336));
  __ubuf__ half * ub_6 = (__ubuf__ half *)((uintptr_t)(14848));
  __ubuf__ int32_t * ub_148 = (__ubuf__ int32_t *)((uintptr_t)(129024));
  __ubuf__ int32_t * ub_144 = (__ubuf__ int32_t *)((uintptr_t)(512));
  __ubuf__ int32_t * ub_140 = (__ubuf__ int32_t *)((uintptr_t)(157696));
  __ubuf__ int32_t * ub_150 = (__ubuf__ int32_t *)((uintptr_t)(71680));
  __ubuf__ int32_t * ub_152 = (__ubuf__ int32_t *)((uintptr_t)(43008));
  __ubuf__ int32_t * ub_138 = (__ubuf__ int32_t *)((uintptr_t)(215040));
  __ubuf__ int32_t * ub_120 = (__ubuf__ int32_t *)((uintptr_t)(258400));
  __ubuf__ int32_t * ub_128 = (__ubuf__ int32_t *)((uintptr_t)(258144));
  __ubuf__ int32_t * ub_116 = (__ubuf__ int32_t *)((uintptr_t)(258208));
  __ubuf__ int32_t * ub_146 = (__ubuf__ int32_t *)((uintptr_t)(186368));
  __ubuf__ int32_t * ub_122 = (__ubuf__ int32_t *)((uintptr_t)(258336));
  __ubuf__ int32_t * ub_118 = (__ubuf__ int32_t *)((uintptr_t)(258080));
  __ubuf__ int32_t * ub_124 = (__ubuf__ int32_t *)((uintptr_t)(243712));
  __ubuf__ int32_t * ub_126 = (__ubuf__ int32_t *)((uintptr_t)(258464));
  __ubuf__ int32_t * ub_114 = (__ubuf__ int32_t *)((uintptr_t)(258272));
  __ubuf__ half * dst_row_193 = (__ubuf__ half *)((uintptr_t)(100352));
  __ubuf__ half * dst_row_205 = (__ubuf__ half *)((uintptr_t)(129024));
  __ubuf__ half * dst_row_197 = (__ubuf__ half *)((uintptr_t)(0));
  __ubuf__ half * dst_row_189 = (__ubuf__ half *)((uintptr_t)(157696));
  __ubuf__ half * dst_row_213 = (__ubuf__ half *)((uintptr_t)(43008));
  __ubuf__ half * dst_row_209 = (__ubuf__ half *)((uintptr_t)(71680));
  __ubuf__ half * dst_row_201 = (__ubuf__ half *)((uintptr_t)(186368));
  __ubuf__ half * dst_row_185 = (__ubuf__ half *)((uintptr_t)(215040));
  __ubuf__ half * dst_row_181 = (__ubuf__ half *)((uintptr_t)(243712));
  __ubuf__ half * ub_100 = (__ubuf__ half *)((uintptr_t)(114688));
  __ubuf__ half * ub_88 = (__ubuf__ half *)((uintptr_t)(143360));
  __ubuf__ half * weighted_row_216 = (__ubuf__ half *)((uintptr_t)(114688));
  __ubuf__ half * ub_108 = (__ubuf__ half *)((uintptr_t)(14336));
  __ubuf__ half * ub_44 = (__ubuf__ half *)((uintptr_t)(258368));
  __ubuf__ half * ub_84 = (__ubuf__ half *)((uintptr_t)(57344));
  __ubuf__ half * ub_92 = (__ubuf__ half *)((uintptr_t)(86016));
  __ubuf__ half * ub_56 = (__ubuf__ half *)((uintptr_t)(258112));
  __ubuf__ half * ub_36 = (__ubuf__ half *)((uintptr_t)(258176));
  __ubuf__ half * ub_104 = (__ubuf__ half *)((uintptr_t)(229376));
  __ubuf__ half * ub_60 = (__ubuf__ half *)((uintptr_t)(258496));
  __ubuf__ half * ub_64 = (__ubuf__ half *)((uintptr_t)(258240));
  __ubuf__ half * ub_96 = (__ubuf__ half *)((uintptr_t)(200704));
  __ubuf__ half * ub_48 = (__ubuf__ half *)((uintptr_t)(258304));
  __ubuf__ half * ub_52 = (__ubuf__ half *)((uintptr_t)(258432));
  __ubuf__ half * ub_40 = (__ubuf__ half *)((uintptr_t)(258048));
  __ubuf__ half * ub_112 = (__ubuf__ half *)((uintptr_t)(172032));
  __ubuf__ half * dst_row_233 = (__ubuf__ half *)((uintptr_t)(100352));
  __ubuf__ half * weighted_row_219 = (__ubuf__ half *)((uintptr_t)(143360));
  __ubuf__ half * weighted_row_217 = (__ubuf__ half *)((uintptr_t)(14336));
  __ubuf__ half * weighted_row_221 = (__ubuf__ half *)((uintptr_t)(57344));
  __ubuf__ half * weighted_row_215 = (__ubuf__ half *)((uintptr_t)(172032));
  __ubuf__ half * local_out_234 = (__ubuf__ half *)((uintptr_t)(0));
  __ubuf__ half * weighted_row_220 = (__ubuf__ half *)((uintptr_t)(86016));
  __ubuf__ half * weighted_row_218 = (__ubuf__ half *)((uintptr_t)(200704));
  __ubuf__ half * local_out_246 = (__ubuf__ half *)((uintptr_t)(14336));
  __ubuf__ half * weighted_row_214 = (__ubuf__ half *)((uintptr_t)(229376));
  __ubuf__ half * local_out_253 = (__ubuf__ half *)((uintptr_t)(0));
  __ubuf__ half * weighted_row_245 = (__ubuf__ half *)((uintptr_t)(43008));
  __ubuf__ half * local_out_256 = (__ubuf__ half *)((uintptr_t)(14336));
  __ubuf__ half * local_out_258 = (__ubuf__ half *)((uintptr_t)(0));
  __ubuf__ half * local_out_263 = (__ubuf__ half *)((uintptr_t)(14336));
  __ubuf__ half * local_out_264 = (__ubuf__ half *)((uintptr_t)(0));
  __ubuf__ half * local_out_244 = (__ubuf__ half *)((uintptr_t)(71680));
  __ubuf__ half * local_out_265 = (__ubuf__ half *)((uintptr_t)(14336));
  __ubuf__ half * local_out_251 = (__ubuf__ half *)((uintptr_t)(28672));
  __ubuf__ half * dst_row_242 = (__ubuf__ half *)((uintptr_t)(129024));
  __ubuf__ half * dst_row_229 = (__ubuf__ half *)((uintptr_t)(157696));
  __ubuf__ half * dst_row_238 = (__ubuf__ half *)((uintptr_t)(186368));
  __ubuf__ half * dst_row_225 = (__ubuf__ half *)((uintptr_t)(215040));
  __ubuf__ half * dst_row_250 = (__ubuf__ half *)((uintptr_t)(243712));
  __ubuf__ half * dst_row_262 = (__ubuf__ half *)((uintptr_t)(143360));
  __ubuf__ half * weighted_row_270 = (__ubuf__ half *)((uintptr_t)(0));
  __ubuf__ half * weighted_row_252 = (__ubuf__ half *)((uintptr_t)(57344));
  __ubuf__ half * local_out_272 = (__ubuf__ half *)((uintptr_t)(43008));
  __ubuf__ half * weighted_row_254 = (__ubuf__ half *)((uintptr_t)(71680));
  __ubuf__ half * local_out_273 = (__ubuf__ half *)((uintptr_t)(0));
  __ubuf__ half * weighted_row_255 = (__ubuf__ half *)((uintptr_t)(86016));
  __ubuf__ half * local_out_275 = (__ubuf__ half *)((uintptr_t)(28672));
  __ubuf__ half * weighted_row_257 = (__ubuf__ half *)((uintptr_t)(114688));
  __ubuf__ half * local_out_276 = (__ubuf__ half *)((uintptr_t)(0));
  __ubuf__ half * weighted_row_271 = (__ubuf__ half *)((uintptr_t)(100352));
  __ubuf__ half * local_out_277 = (__ubuf__ half *)((uintptr_t)(28672));
  __ubuf__ half * weighted_row_274 = (__ubuf__ half *)((uintptr_t)(43008));
  __ubuf__ half * local_out_278 = (__ubuf__ half *)((uintptr_t)(0));
  __ubuf__ half * local_out_279 = (__ubuf__ half *)((uintptr_t)(28672));
  copy_gm_to_ubuf(ub_idx_1, (__gm__ int32_t *)gm_sorted_idx, 0, 1, 16, 0, 0);
  int32_t block_idx_8 = (int32_t)block_idx;
  vector_dup(local_out_3 + 0, (half)0.0000000000, 56, 1, 0, 8, 0);
  pipe_barrier(PIPE_S);
  int32_t scalar_12 = float(block_idx_8) * float(2);
  pipe_barrier(PIPE_S);
  int32_t scalar_16 = float(scalar_12) + float(1);
  pipe_barrier(PIPE_S);
  int32_t scalar_70 = float(48) + float(scalar_16);
  int32_t scalar_10 = float(block_idx_8) * float(2);
  int32_t scalar_72 = float(0) + float(scalar_16);
  int32_t scalar_76 = float(64) + float(scalar_16);
  pipe_barrier(PIPE_S);
  int32_t scalar_14 = float(scalar_10) + float(0);
  int32_t scalar_66 = float(112) + float(scalar_16);
  int32_t scalar_68 = float(80) + float(scalar_16);
  int32_t scalar_74 = float(96) + float(scalar_16);
  int32_t scalar_78 = float(32) + float(scalar_16);
  int32_t scalar_80 = float(16) + float(scalar_16);
  pipe_barrier(PIPE_S);
  int32_t scalar_18 = float(64) + float(scalar_14);
  int32_t scalar_20 = float(48) + float(scalar_14);
  int32_t scalar_22 = float(16) + float(scalar_14);
  int32_t scalar_24 = float(96) + float(scalar_14);
  int32_t scalar_26 = float(80) + float(scalar_14);
  int32_t scalar_28 = float(0) + float(scalar_14);
  int32_t scalar_30 = float(112) + float(scalar_14);
  int32_t scalar_32 = float(32) + float(scalar_14);
  set_flag(PIPE_S, PIPE_V, (event_t)0);
  wait_flag(PIPE_S, PIPE_V, (event_t)0);
  pipe_barrier(PIPE_V);
  set_flag(PIPE_MTE2, PIPE_V, (event_t)0);
  wait_flag(PIPE_MTE2, PIPE_V, (event_t)0);
  copy_ubuf_to_ubuf(ub_142, ub_idx_1 + scalar_70, 0, 1, 1, 15, 0);
  copy_gm_to_ubuf(prob_ub_7, (__gm__ half *)gm_probs, 0, 1, 8, 0, 0);
  set_flag(PIPE_MTE2, PIPE_V, (event_t)0);
  wait_flag(PIPE_MTE2, PIPE_V, (event_t)0);
  v4dtrans((__ubuf__ uint16_t*)ub_5, (__ubuf__ uint16_t*)prob_ub_7, 16, 8, true);
  pipe_barrier(PIPE_V);
  v4dtrans((__ubuf__ uint16_t*)ub_6, (__ubuf__ uint16_t*)ub_5, 16, 16, false);
  pipe_barrier(PIPE_V);
  copy_ubuf_to_ubuf(prob_ub_7, ub_6, 0, 1, 16, 0, 0);
  pipe_barrier(PIPE_V);
  set_flag(PIPE_V, PIPE_S, (event_t)0);
  wait_flag(PIPE_V, PIPE_S, (event_t)0);
  int32_t idx_171 = *(__ubuf__ int32_t *)ub_142;
  copy_ubuf_to_ubuf(ub_148, ub_idx_1 + scalar_76, 0, 1, 1, 15, 0);
  copy_ubuf_to_ubuf(ub_144, ub_idx_1 + scalar_72, 0, 1, 1, 15, 0);
  copy_ubuf_to_ubuf(ub_140, ub_idx_1 + scalar_68, 0, 1, 1, 15, 0);
  copy_ubuf_to_ubuf(ub_150, ub_idx_1 + scalar_78, 0, 1, 1, 15, 0);
  copy_ubuf_to_ubuf(ub_152, ub_idx_1 + scalar_80, 0, 1, 1, 15, 0);
  copy_ubuf_to_ubuf(ub_138, ub_idx_1 + scalar_66, 0, 1, 1, 15, 0);
  copy_ubuf_to_ubuf(ub_120, ub_idx_1 + scalar_24, 0, 1, 1, 15, 0);
  copy_ubuf_to_ubuf(ub_128, ub_idx_1 + scalar_32, 0, 1, 1, 15, 0);
  copy_ubuf_to_ubuf(ub_116, ub_idx_1 + scalar_20, 0, 1, 1, 15, 0);
  copy_ubuf_to_ubuf(ub_146, ub_idx_1 + scalar_74, 0, 1, 1, 15, 0);
  copy_ubuf_to_ubuf(ub_122, ub_idx_1 + scalar_26, 0, 1, 1, 15, 0);
  copy_ubuf_to_ubuf(ub_118, ub_idx_1 + scalar_22, 0, 1, 1, 15, 0);
  copy_ubuf_to_ubuf(ub_124, ub_idx_1 + scalar_28, 0, 1, 1, 15, 0);
  copy_ubuf_to_ubuf(ub_126, ub_idx_1 + scalar_30, 0, 1, 1, 15, 0);
  copy_ubuf_to_ubuf(ub_114, ub_idx_1 + scalar_18, 0, 1, 1, 15, 0);
  set_flag(PIPE_V, PIPE_S, (event_t)0);
  wait_flag(PIPE_V, PIPE_S, (event_t)0);
  int32_t idx_174 = *(__ubuf__ int32_t *)ub_148;
  set_flag(PIPE_V, PIPE_MTE2, (event_t)0);
  wait_flag(PIPE_V, PIPE_MTE2, (event_t)0);
  set_flag(PIPE_V, PIPE_S, (event_t)0);
  wait_flag(PIPE_V, PIPE_S, (event_t)0);
  int32_t idx_172 = *(__ubuf__ int32_t *)ub_144;
  int32_t idx_170 = *(__ubuf__ int32_t *)ub_140;
  int32_t idx_176 = *(__ubuf__ int32_t *)ub_152;
  int32_t idx_175 = *(__ubuf__ int32_t *)ub_150;
  int32_t idx_173 = *(__ubuf__ int32_t *)ub_146;
  int32_t idx_169 = *(__ubuf__ int32_t *)ub_138;
  int32_t idx_166 = *(__ubuf__ int32_t *)ub_124;
  int32_t idx_163 = *(__ubuf__ int32_t *)ub_118;
  int32_t idx_168 = *(__ubuf__ int32_t *)ub_128;
  int32_t idx_162 = *(__ubuf__ int32_t *)ub_116;
  int32_t idx_161 = *(__ubuf__ int32_t *)ub_114;
  int32_t idx_165 = *(__ubuf__ int32_t *)ub_122;
  int32_t idx_164 = *(__ubuf__ int32_t *)ub_120;
  int32_t idx_167 = *(__ubuf__ int32_t *)ub_126;
  set_flag(PIPE_S, PIPE_MTE2, (event_t)0);
  wait_flag(PIPE_S, PIPE_MTE2, (event_t)0);
  copy_gm_to_ubuf(dst_row_193, (__gm__ half *)gm_permute_token + (idx_171) * 7168, 0, 1, 448, 56896, 0);
  copy_gm_to_ubuf(dst_row_205, (__gm__ half *)gm_permute_token + (idx_174) * 7168, 0, 1, 448, 56896, 0);
  copy_gm_to_ubuf(dst_row_197, (__gm__ half *)gm_permute_token + (idx_172) * 7168, 0, 1, 448, 56896, 0);
  copy_gm_to_ubuf(dst_row_189, (__gm__ half *)gm_permute_token + (idx_170) * 7168, 0, 1, 448, 56896, 0);
  copy_gm_to_ubuf(dst_row_213, (__gm__ half *)gm_permute_token + (idx_176) * 7168, 0, 1, 448, 56896, 0);
  copy_gm_to_ubuf(dst_row_209, (__gm__ half *)gm_permute_token + (idx_175) * 7168, 0, 1, 448, 56896, 0);
  copy_gm_to_ubuf(dst_row_201, (__gm__ half *)gm_permute_token + (idx_173) * 7168, 0, 1, 448, 56896, 0);
  copy_gm_to_ubuf(dst_row_185, (__gm__ half *)gm_permute_token + (idx_169) * 7168, 0, 1, 448, 56896, 0);
  copy_gm_to_ubuf(dst_row_181, (__gm__ half *)gm_permute_token + (idx_166) * 7168, 0, 1, 448, 56896, 0);
  set_flag(PIPE_MTE2, PIPE_V, (event_t)0);
  wait_flag(PIPE_MTE2, PIPE_V, (event_t)0);
  copy_ubuf_to_ubuf(ub_100, prob_ub_7 + ((scalar_16) * 16) + 3, 0, 1, 1, 0, 0);
  set_flag(PIPE_MTE2, PIPE_V, (event_t)0);
  wait_flag(PIPE_MTE2, PIPE_V, (event_t)0);
  set_flag(PIPE_V, PIPE_S, (event_t)0);
  wait_flag(PIPE_V, PIPE_S, (event_t)0);
  half prob_157 = *(__ubuf__ half *)ub_100;
  copy_ubuf_to_ubuf(ub_88, prob_ub_7 + ((scalar_16) * 16) + 4, 0, 1, 1, 0, 0);
  set_flag(PIPE_S, PIPE_V, (event_t)0);
  wait_flag(PIPE_S, PIPE_V, (event_t)0);
  vmuls(weighted_row_216 + 0, dst_row_193 + 0, prob_157, 56, 1, 1, 8, 8);
  copy_ubuf_to_ubuf(ub_108, prob_ub_7 + ((scalar_16) * 16) + 0, 0, 1, 1, 0, 0);
  copy_ubuf_to_ubuf(ub_44, prob_ub_7 + ((scalar_14) * 16) + 5, 0, 1, 1, 0, 0);
  copy_ubuf_to_ubuf(ub_84, prob_ub_7 + ((scalar_16) * 16) + 1, 0, 1, 1, 0, 0);
  copy_ubuf_to_ubuf(ub_92, prob_ub_7 + ((scalar_16) * 16) + 2, 0, 1, 1, 0, 0);
  copy_ubuf_to_ubuf(ub_56, prob_ub_7 + ((scalar_14) * 16) + 1, 0, 1, 1, 0, 0);
  copy_ubuf_to_ubuf(ub_36, prob_ub_7 + ((scalar_14) * 16) + 2, 0, 1, 1, 0, 0);
  copy_ubuf_to_ubuf(ub_104, prob_ub_7 + ((scalar_16) * 16) + 7, 0, 1, 1, 0, 0);
  copy_ubuf_to_ubuf(ub_60, prob_ub_7 + ((scalar_14) * 16) + 7, 0, 1, 1, 0, 0);
  copy_ubuf_to_ubuf(ub_64, prob_ub_7 + ((scalar_14) * 16) + 3, 0, 1, 1, 0, 0);
  copy_ubuf_to_ubuf(ub_96, prob_ub_7 + ((scalar_16) * 16) + 6, 0, 1, 1, 0, 0);
  copy_ubuf_to_ubuf(ub_48, prob_ub_7 + ((scalar_14) * 16) + 4, 0, 1, 1, 0, 0);
  copy_ubuf_to_ubuf(ub_52, prob_ub_7 + ((scalar_14) * 16) + 6, 0, 1, 1, 0, 0);
  copy_ubuf_to_ubuf(ub_40, prob_ub_7 + ((scalar_14) * 16) + 0, 0, 1, 1, 0, 0);
  copy_ubuf_to_ubuf(ub_112, prob_ub_7 + ((scalar_16) * 16) + 5, 0, 1, 1, 0, 0);
  set_flag(PIPE_V, PIPE_S, (event_t)0);
  wait_flag(PIPE_V, PIPE_S, (event_t)0);
  half prob_154 = *(__ubuf__ half *)ub_88;
  set_flag(PIPE_V, PIPE_MTE2, (event_t)0);
  wait_flag(PIPE_V, PIPE_MTE2, (event_t)0);
  copy_gm_to_ubuf(dst_row_233, (__gm__ half *)gm_permute_token + (idx_163) * 7168, 0, 1, 448, 56896, 0);
  pipe_barrier(PIPE_V);
  set_flag(PIPE_V, PIPE_S, (event_t)0);
  wait_flag(PIPE_V, PIPE_S, (event_t)0);
  half prob_159 = *(__ubuf__ half *)ub_108;
  set_flag(PIPE_S, PIPE_V, (event_t)0);
  wait_flag(PIPE_S, PIPE_V, (event_t)0);
  vmuls(weighted_row_219 + 0, dst_row_205 + 0, prob_154, 56, 1, 1, 8, 8);
  half prob_153 = *(__ubuf__ half *)ub_84;
  half prob_160 = *(__ubuf__ half *)ub_112;
  half prob_155 = *(__ubuf__ half *)ub_92;
  half prob_156 = *(__ubuf__ half *)ub_96;
  half prob_158 = *(__ubuf__ half *)ub_104;
  half prob_130 = *(__ubuf__ half *)ub_40;
  half prob_134 = *(__ubuf__ half *)ub_56;
  half prob_129 = *(__ubuf__ half *)ub_36;
  half prob_136 = *(__ubuf__ half *)ub_64;
  half prob_132 = *(__ubuf__ half *)ub_48;
  half prob_131 = *(__ubuf__ half *)ub_44;
  half prob_133 = *(__ubuf__ half *)ub_52;
  half prob_135 = *(__ubuf__ half *)ub_60;
  set_flag(PIPE_S, PIPE_V, (event_t)0);
  wait_flag(PIPE_S, PIPE_V, (event_t)0);
  vmuls(weighted_row_217 + 0, dst_row_197 + 0, prob_159, 56, 1, 1, 8, 8);
  vmuls(weighted_row_221 + 0, dst_row_213 + 0, prob_153, 56, 1, 1, 8, 8);
  vmuls(weighted_row_215 + 0, dst_row_189 + 0, prob_160, 56, 1, 1, 8, 8);
  pipe_barrier(PIPE_V);
  vadd(local_out_234 + 0, local_out_3 + 0, weighted_row_217 + 0, 56, 1, 1, 1, 8, 8, 8);
  vmuls(weighted_row_220 + 0, dst_row_209 + 0, prob_155, 56, 1, 1, 8, 8);
  vmuls(weighted_row_218 + 0, dst_row_201 + 0, prob_156, 56, 1, 1, 8, 8);
  pipe_barrier(PIPE_V);
  vadd(local_out_246 + 0, local_out_234 + 0, weighted_row_221 + 0, 56, 1, 1, 1, 8, 8, 8);
  vmuls(weighted_row_214 + 0, dst_row_185 + 0, prob_158, 56, 1, 1, 8, 8);
  pipe_barrier(PIPE_V);
  vadd(local_out_253 + 0, local_out_246 + 0, weighted_row_220 + 0, 56, 1, 1, 1, 8, 8, 8);
  vmuls(weighted_row_245 + 0, dst_row_181 + 0, prob_130, 56, 1, 1, 8, 8);
  pipe_barrier(PIPE_V);
  vadd(local_out_256 + 0, local_out_253 + 0, weighted_row_216 + 0, 56, 1, 1, 1, 8, 8, 8);
  pipe_barrier(PIPE_V);
  vadd(local_out_258 + 0, local_out_256 + 0, weighted_row_219 + 0, 56, 1, 1, 1, 8, 8, 8);
  set_flag(PIPE_V, PIPE_MTE2, (event_t)0);
  wait_flag(PIPE_V, PIPE_MTE2, (event_t)0);
  pipe_barrier(PIPE_V);
  vadd(local_out_263 + 0, local_out_258 + 0, weighted_row_215 + 0, 56, 1, 1, 1, 8, 8, 8);
  pipe_barrier(PIPE_V);
  vadd(local_out_264 + 0, local_out_263 + 0, weighted_row_218 + 0, 56, 1, 1, 1, 8, 8, 8);
  pipe_barrier(PIPE_V);
  vector_dup(local_out_244 + 0, (half)0.0000000000, 56, 1, 0, 8, 0);
  pipe_barrier(PIPE_V);
  vadd(local_out_265 + 0, local_out_264 + 0, weighted_row_214 + 0, 56, 1, 1, 1, 8, 8, 8);
  pipe_barrier(PIPE_V);
  vadd(local_out_251 + 0, local_out_244 + 0, weighted_row_245 + 0, 56, 1, 1, 1, 8, 8, 8);
  pipe_barrier(PIPE_V);
  set_flag(PIPE_V, PIPE_MTE3, (event_t)0);
  wait_flag(PIPE_V, PIPE_MTE3, (event_t)0);
  copy_ubuf_to_gm((__gm__ half *)gm_output + (scalar_16) * 7168, local_out_265, 0, 1, 448, 0, 6720);
  copy_gm_to_ubuf(dst_row_242, (__gm__ half *)gm_permute_token + (idx_168) * 7168, 0, 1, 448, 56896, 0);
  copy_gm_to_ubuf(dst_row_229, (__gm__ half *)gm_permute_token + (idx_162) * 7168, 0, 1, 448, 56896, 0);
  copy_gm_to_ubuf(dst_row_238, (__gm__ half *)gm_permute_token + (idx_161) * 7168, 0, 1, 448, 56896, 0);
  copy_gm_to_ubuf(dst_row_225, (__gm__ half *)gm_permute_token + (idx_165) * 7168, 0, 1, 448, 56896, 0);
  copy_gm_to_ubuf(dst_row_250, (__gm__ half *)gm_permute_token + (idx_164) * 7168, 0, 1, 448, 56896, 0);
  copy_gm_to_ubuf(dst_row_262, (__gm__ half *)gm_permute_token + (idx_167) * 7168, 0, 1, 448, 56896, 0);
  set_flag(PIPE_MTE2, PIPE_V, (event_t)0);
  wait_flag(PIPE_MTE2, PIPE_V, (event_t)0);
  vmuls(weighted_row_270 + 0, dst_row_233 + 0, prob_134, 56, 1, 1, 8, 8);
  set_flag(PIPE_MTE2, PIPE_V, (event_t)0);
  wait_flag(PIPE_MTE2, PIPE_V, (event_t)0);
  pipe_barrier(PIPE_V);
  vmuls(weighted_row_252 + 0, dst_row_242 + 0, prob_129, 56, 1, 1, 8, 8);
  vadd(local_out_272 + 0, local_out_251 + 0, weighted_row_270 + 0, 56, 1, 1, 1, 8, 8, 8);
  vmuls(weighted_row_254 + 0, dst_row_229 + 0, prob_136, 56, 1, 1, 8, 8);
  pipe_barrier(PIPE_V);
  vadd(local_out_273 + 0, local_out_272 + 0, weighted_row_252 + 0, 56, 1, 1, 1, 8, 8, 8);
  vmuls(weighted_row_255 + 0, dst_row_238 + 0, prob_132, 56, 1, 1, 8, 8);
  pipe_barrier(PIPE_V);
  vadd(local_out_275 + 0, local_out_273 + 0, weighted_row_254 + 0, 56, 1, 1, 1, 8, 8, 8);
  vmuls(weighted_row_257 + 0, dst_row_225 + 0, prob_131, 56, 1, 1, 8, 8);
  pipe_barrier(PIPE_V);
  vadd(local_out_276 + 0, local_out_275 + 0, weighted_row_255 + 0, 56, 1, 1, 1, 8, 8, 8);
  vmuls(weighted_row_271 + 0, dst_row_250 + 0, prob_133, 56, 1, 1, 8, 8);
  pipe_barrier(PIPE_V);
  vadd(local_out_277 + 0, local_out_276 + 0, weighted_row_257 + 0, 56, 1, 1, 1, 8, 8, 8);
  vmuls(weighted_row_274 + 0, dst_row_262 + 0, prob_135, 56, 1, 1, 8, 8);
  pipe_barrier(PIPE_V);
  vadd(local_out_278 + 0, local_out_277 + 0, weighted_row_271 + 0, 56, 1, 1, 1, 8, 8, 8);
  pipe_barrier(PIPE_V);
  vadd(local_out_279 + 0, local_out_278 + 0, weighted_row_274 + 0, 56, 1, 1, 1, 8, 8, 8);
  set_flag(PIPE_V, PIPE_MTE3, (event_t)0);
  wait_flag(PIPE_V, PIPE_MTE3, (event_t)0);
  copy_ubuf_to_gm((__gm__ half *)gm_output + (scalar_14) * 7168, local_out_279, 0, 1, 448, 0, 6720);
}
__global__ __aicore__ void ai_core_do(__gm__ uint8_t *__restrict__ gm_permute_token, __gm__ uint8_t *__restrict__ gm_sorted_idx, __gm__ uint8_t *__restrict__ gm_probs, __gm__ uint8_t *__restrict__ gm_output){
  moe_token_unpermute_op_impl_npu_0_kernel(gm_permute_token, gm_sorted_idx, gm_probs, gm_output);
}
extern "C"  void ai_core(uint32_t blockDim, void *l2ctrl, void *stream, uint8_t * gm_permute_token, uint8_t * gm_sorted_idx, uint8_t * gm_probs, uint8_t * gm_output){
  ai_core_do<<<8, l2ctrl, stream>>>(gm_permute_token, gm_sorted_idx, gm_probs, gm_output);
}
